{% extends "base.html" %}
{% block title %}Register â€¢ PolyPaper{% endblock %}

{% block content %}
<div class="auth-shell">

<section class="auth-hero">
    <div class="auth-hero-text">
        <h1>Welcome to Polypaper - Register an Account</h1>
        <!-- We will change this text later once its all set up -->
        <p class="auth-subtitle">Practice your prediction market trading!</p>

        <ul class="auth-benefits">
            <li>Track a simulated balance and open positions across sessions.</li>
            <li>Save and document your trades</li>
            <li>Analyze your returns</li>
        </ul>
    </div>

    <!-- Right column holds actual registration form that posts back here. -->
     <div class="card auth-card">
        <div class="card-header auth-header">
            <span class="card-title">Register</span>
        </div>

        <!-- Form posts to /register so we can validate and write to mongodb-->
        <form class ="auth-form" method="post" action="{{ url_for('register') }}">
            <label class="form-field">
                <span class="field-label">Email</span>
                <input type="email" name="email" placeholder="you@example.com" required>
            </label>

            <label class="form-field">
                <span class="field-label">Username</span>
                <input type="text" name="username" placeholder="username" required>
            </label>

            <label class="form-field">
                <span class="field-label">Password</span>
                <input type="password" name="password" placeholder="At least 8 characters" minlength="8" required>
            </label>

            <label class="form-field">
                <span class="field-label">Confirm password</span>
                <input type="password" name="confirm_password" placeholder="Retype your password" minlength="8" required>
                <span id="password-mismatch" style="display:none;color:#d9534f;font-size:0.9rem;">Password does not match</span>
            </label>

            <label class="form-field">
                <span class="field-label">Set starting balance</span>
                <input type="number" name="starting_balance" min="1" max="1000000" step="1" value="1000000" required>
                <small class="field-hint">Choose between 1 and 1,000,000.</small>
            </label>
            
            <button class="btn-primary" type="submit">Create account</button>

            <p class="auth-meta">Already registered? <a href="{{ url_for('login') }}">Log in</a>.</p>
        </form>
     </div>
</section>

</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const form = document.querySelector(".auth-form");
    const passwordInput = form.querySelector('input[name="password"]');
    const confirmInput = form.querySelector('input[name="confirm_password"]');
    const submitBtn = form.querySelector('button[type="submit"]');
    const mismatchMsg = document.getElementById("password-mismatch");

    const validatePasswords = () => {
        const pwd = passwordInput.value;
        const confirm = confirmInput.value;
        const mismatch = (pwd || confirm) && pwd !== confirm;

        mismatchMsg.style.display = mismatch ? "block" : "none";
        submitBtn.disabled = mismatch || !pwd || !confirm;
    };

    passwordInput.addEventListener("input", validatePasswords);
    confirmInput.addEventListener("input", validatePasswords);
    validatePasswords();
});
</script>

{% endblock %}

{% extends "base.html" %}
{% block title %}Portfolio • PolyPaper{% endblock %}

{% block content %}

<section class="portfolio-grid">
  <div class="card portfolio-card">
    <div class="card-header">
      <span class="card-title">Portfolio Value</span>
      <span class="card-subtitle">Total Value</span>
    </div>
    <div class="card-main">
      <div class="card-value">
        ${{ "%.2f"|format(current_user.total_value) }}
      </div>
    </div>
  </div>

  <div class="card balance-card">
    <div class="card-header">
      <span class="card-title">Cash Balance</span>
      <span class="card-subtitle">Cash Available</span>
    </div>
    <div class="card-main">
      <div class="card-value">
        ${{ "%.2f"|format(current_user.balance) }}
      </div>
    </div>
  </div>

  <div class="card pl-card">
    <div class="card-header">
      <span class="card-title">All Time P&L</span>
      <span class="card-subtitle">Profit/Loss</span>
    </div>
    <div class="card-main">
      <div class="card-value {{ 'positive' if current_user.change_today >= 0 else 'negative' }}">
        {% if current_user.change_today >= 0 %}▲{% else %}▼{% endif %}
        ${{ "%.2f"|format(current_user.change_today) }}
      </div>
    </div>
  </div>
</section>

<section class="positions-section">

  {% if positions %}
  <table class="positions-table">
    <thead>
      <tr>
        <th>Market</th>
        <th>Side</th>
        <th>Shares</th>
        <th>Avg → Now</th>
        <th>Bet</th>
        <th>To win</th>
        <th>Value</th>
      </tr>
    </thead>
    <tbody>
      {% for p in positions %}
      {% set value = p.market_value %}
      <tr>
        <td>{{ p.market }}</td>
        <td>{{ p.side }}</td>
        <td>{{ "%.2f"|format(p.quantity) }}</td>
        <td>{{ "%.2f"|format(p.avg_price) }} → {{ "%.2f"|format(p.current_price) }}</td>
        <td>${{ "%.2f"|format(p.bet_amount) }}</td>
        <td>
            <span class="value-chip {{ 'positive' if p.to_win >= 0 else 'negative' }}">
                {{ '+' if p.to_win >= 0 else '' }}${{ "%.2f"|format(p.to_win) }}
            </span>
        </td>
        <td>${{ "%.2f"|format(value) }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  {% else %}
  <div class="empty-state">
    <p>No positions found.</p>
    <p class="hint">Search for a market and place your first paper trade.</p>
  </div>
  {% endif %}
</section>

{% endblock %}
